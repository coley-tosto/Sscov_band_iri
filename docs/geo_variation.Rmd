---
title: "Geographic Variarion of Iridescence"
author: "Coley Tosto"
output: html_document
date: "`r Sys.Date()`"
---

```{r knitsetup, include=FALSE}
knitr::opts_knit$set(root.dir='../',fig_path="../figs/")
```


```{r chunksetup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,out.extra='',fig.pos="H",
                      fig.path = "../figs/",
                      dpi = 300,dev='png')
```

```{r library, message=FALSE, warning=FALSE}
library(car)
library(knitr)
library(kableExtra)
library(tidyverse)
library(multcompView)
library(MASS)
library(ggplot2)
library(cowplot)
```

```{r functions}
##Function used to add Tukey Letters to Boxplot Figures
generate_label_df <- function(TUKEY, variable){
  
  #Extract labels and factor levels from Tukey post-hoc test
  Tukey.levels <- TUKEY[[variable]][, 4]
  Tukey.labels <- data.frame(multcompLetters(Tukey.levels)['Letters'])
  
  #Putting the labels in the same order as in the boxplot :
  Tukey.labels$treatment=rownames(Tukey.labels)
  Tukey.labels=Tukey.labels[order(Tukey.labels$treatment) , ]
  return(Tukey.labels)
}
```

```{r read-data}
geo_data <- read.csv("processed_data/geo.csv")
geo_data$Location <- as.factor(geo_data$Location)

##The subsetted data created as per the next section
geo_subset <- read.csv("processed_data/geovar.csv")
geo_subset$Location <- as.factor(geo_subset$Location)

##This dataset is used for the band area vs iridescence analysis
area_iri <- read.csv("processed_data/ehs-LOCATION.csv")
```

## Subsetting the dataset
In order to run a one-way ANOVA to see if iridescence is different across the different geographic populations, we needed an equal sample size for each pop. The original dataset contained `r nrow(geo_data[which(geo_data$Location == "FLAB"),])`, `r  nrow(geo_data[which(geo_data$Location == "FLFD"),])`, `r  nrow(geo_data[which(geo_data$Location == "TXSP"),])`, and `r  nrow(geo_data[which(geo_data$Location == "TXPA"),])` female pipefish from the Florida Anne's Beach, Florida Fort De Soto, Texas South Padre, and Texas Port Aransas population respectively. The smallest sample size (TX South Padre), was then chosen as the number randomly sampled from the other populations.

```{r subset-pops, eval=FALSE}
##Subsetting the individual populations
FLAB<-subset(geo_data,Location=="FLAB")
FLFD<-subset(geo_data,Location=="FLFD")
TXSP<-subset(geo_data,Location=="TXSP")
TXPA<-subset(geo_data,Location=="TXPA")

##Randomly selecting 17 from each population
flabw<-FLAB[sample(1:nrow(FLAB),17,replace=FALSE),]
flfdw<-FLFD[sample(1:nrow(FLFD),17,replace=FALSE),]
txspw<-TXSP[sample(1:nrow(TXSP),17,replace=FALSE),]
txpaw<-TXPA[sample(1:nrow(TXPA),17,replace=FALSE),]
set.seed(123) ##Allows for reproducability if re-run in the same session

##Combining the new subsets in a new dataset
geovar<-rbind(flabw,flfdw,txspw,txpaw)

##Writing out the dataset to ensure it is the same if further analysis is needed
write.csv(geovar,"geovar.csv")
```

## Analysis

```{r, echo=FALSE}
geo_subset %>% 
  group_by(Location) %>% 
  summarise(across(c("depth", "band_num", "mean_hard", "total_easy"), ~ mean(.x, na.rm = TRUE))) %>%
  kable(caption = "Summarized Data", format = "html") %>% 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), full_width = F, position = "left") %>%
  footnote(general = "Summarized here are the means across location for each of the variables")
```
### Length across Location {.tabset}

#### Summary table
```{r table_length, echo=FALSE}
geo_subset %>%
  group_by(Location) %>%
  summarise(across(c("length"), list(mean = mean, SD = sd))) %>%
  kable(caption = "Summarized Data", format = 'html') %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), full_width = F, position = "left")
```
#### Histogram
```{r histogram_length, message=FALSE, echo=FALSE, fig.cap="Histogram of female body length (mm) across the four locations"}
length_hist <- ggplot(data = geo_subset, aes(x = length)) +
  geom_histogram(aes(fill = Location),
                 alpha = 0.5,
                 position = 'identity') +
  scale_fill_manual(values = c("darkorange", "purple", "cyan4", "indianred")) +
  theme_minimal() +
  labs(x = "Length (mm)",
       y = "Number of Pipefish",
       title = "Length of female pipefish")

length_hist

```
### {-}
#### Testing assumptions
```{r test-assumptions-length}
leveneTest(length~Location, geo_subset)

lengthaov<-aov(geo_subset$length~geo_subset$Location)
lengthresid<-resid(lengthaov)
shapiro.test(lengthresid)

par(mfrow=c(2,2))
plot(lengthaov)

```

All assumptions met, can proceed with one-way ANOVA. 

#### Running one-way ANOVA between Length and Location
```{r run-anova-length}
summary(lengthaov)

#Post-hoc Analysis
tukey_length <- TukeyHSD(x=lengthaov, 'geo_subset$Location', conf.level = 0.95)
tukey_length
```
Significant ANOVA results. From the post-hoc analysis we can see significant differences between the lengths of females from the Florida and Texas populations.

```{r posthoc-letters-length, echo=F}
multcompLetters4(lengthaov, TukeyHSD(lengthaov))

par(mfrow=c(1,1))
boxplot(length~Location,data=geo_subset,ylab="Length (mm)",xlab="Location",main="")
```

```{r fig-length, echo=F}
#Generate labels using function
labels_length <- generate_label_df(tukey_length, "geo_subset$Location")

#Rename columns for merging
names(labels_length) <- c('Letters', 'Location')

#Obtain letter position for y axis using means
yvalue_length <- aggregate(length~Location, data=geo_subset, mean)

#Merge dataframes
final_length <- merge(labels_length, yvalue_length)

length <- ggplot(geo_subset, aes(x = Location, y = length)) +
       geom_boxplot(fill = 'grey23', alpha = 0.3) +
       xlab("Location") +
       ylab("Length (mm)") +
       geom_text(data = final_length, aes(x = Location, y = length, label = Letters),
                 vjust = -6.5, hjust = 0.4) +
       theme_minimal() +
       theme(text = element_text(size = 12, family = 'sans', color = "black"))

```


### Snout-vent Length across Location {.tabset}

#### Summary table
```{r table_SVL, echo=FALSE}
geo_subset %>%
  group_by(Location) %>%
  summarise(across(c("SVL"), list(mean = mean, SD = sd))) %>%
  kable(caption = "Summarized Data", format = 'html') %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), full_width = F, position = "left")
```
#### Histogram
```{r histogram_svl, message=FALSE, echo=FALSE, fig.cap="Histogram of female snout-vent length (mm) across the four locations"}
SVL_hist <- ggplot(data = geo_subset, aes(x = SVL)) +
  geom_histogram(aes(fill = Location),
                 alpha = 0.5,
                 position = 'identity') +
  scale_fill_manual(values = c("darkorange", "purple", "cyan4", "indianred")) +
  theme_minimal() +
  labs(x = "Snout-vent Length (mm)",
       y = "Number of Pipefish",
       title = "SVL of female pipefish")

SVL_hist

```
### {-}
#### Testing assumptions
```{r test-assumptions-svl}
leveneTest(SVL~Location, geo_subset)

SVLaov<-aov(geo_subset$SVL~geo_subset$Location)
SVLresid<-resid(SVLaov)
shapiro.test(SVLresid)

par(mfrow=c(2,2))
plot(SVLaov)

```

All assumptions met, can proceed with one-way ANOVA. 

#### Running one-way ANOVA between Snout-vent Length and Location
```{r run-anova-svl}
summary(SVLaov)

#Post-hoc Analysis
tukey_SVL <- TukeyHSD(x=SVLaov, 'geo_subset$Location', conf.level = 0.95)
tukey_SVL
```
Significant ANOVA results. From the post-hoc analysis we can see significant differences between the lengths of females from the Florida and Texas populations.

```{r posthoc-letters-svl, echo=F}
multcompLetters4(SVLaov, TukeyHSD(SVLaov))

par(mfrow=c(1,1))
boxplot(SVL~Location,data=geo_subset,ylab="Snout-vent Length (mm)",xlab="Location",main="")
```

```{r fig-svl, echo=F}
#Generate labels using function
labels_SVL <- generate_label_df(tukey_SVL, "geo_subset$Location")

#Rename columns for merging
names(labels_SVL) <- c('Letters', 'Location')

#Obtain letter position for y axis using means
yvalue_SVL <- aggregate(SVL~Location, data=geo_subset, mean)

#Merge dataframes
final_SVL <- merge(labels_SVL, yvalue_SVL)

SVL <- ggplot(geo_subset, aes(x = Location, y = SVL)) +
       geom_boxplot(fill = 'grey23', alpha = 0.3) +
       xlab("Location") +
       ylab("Snout-vent Length (mm)") +
       geom_text(data = final_SVL, aes(x = Location, y = SVL, label = Letters),
                 vjust = -6.5, hjust = 0.4) +
       theme_minimal() +
       theme(text = element_text(size = 12, family = 'sans', color = "black"))

```


### Depth across Location {.tabset}

#### Summary table
```{r table_depth, echo=FALSE}
geo_subset %>% 
  group_by(Location) %>% 
  summarise(across(c("depth"),  list(mean = mean, SD = sd))) %>%
  kable(caption = "Summarized Data", format = "html") %>% 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), full_width = F, position = "left")
```
#### Histogram
```{r histogram_depth, message=F, echo = F, fig.cap = "Histogram of female body depth(mm) across the four locations"}
depth_hist <- ggplot(data = geo_subset, aes(x = depth)) +
  geom_histogram(aes(fill = Location), 
                 alpha = 0.5, 
                 position = "identity") +
  scale_fill_manual(values = c("darkorange","purple","cyan4", "indianred")) +
  theme_minimal() +
  labs(x = "Depth (mm)",
       y = "Frequency",
       title = "Female Body Depths")
depth_hist
```

### {-}
#### Testing assumptions
```{r test-assumptions-depth}
leveneTest(depth~Location, geo_subset)

depthaov<-aov(geo_subset$depth~geo_subset$Location)
depthresid<-resid(depthaov)
shapiro.test(depthresid)

par(mfrow=c(2,2))
plot(depthaov)

```
All assumptions met, can proceed with one-way ANOVA. 

#### Running one-way ANOVA between Depth and Location
```{r run-anova-depth}
summary(depthaov)

#Post-hoc Analysis
tukey_depth <- TukeyHSD(x=depthaov, 'geo_subset$Location', conf.level = 0.95)
tukey_depth
```
Significant ANOVA results. From the post-hoc analysis we can see significant differences between the depths of females from the Florida and Texas populations and between the two Texas populations.
```{r posthoc-letters-depth, echo=F}
multcompLetters4(depthaov, TukeyHSD(depthaov))

par(mfrow=c(1,1))
boxplot(depth~Location,data=geo_subset,ylab="Depth (mm)",xlab="Location",main="")
```

Because of the difference in depths across the locations for all of the subsequent analyses iridescent measurements will be adjusted for by depth (iridescence/depth) resulting in Depth-adjust iridescence measurements.

```{r fig-depth, echo=F}
#Generate labels using function
labels_depth <- generate_label_df(tukey_depth, "geo_subset$Location")

#Rename columns for merging
names(labels_depth) <- c('Letters', 'Location')

#Obtain letter position for y axis using means
yvalue_depth <- aggregate(depth~Location, data=geo_subset, mean)

#Merge dataframes
final_depth <- merge(labels_depth, yvalue_depth)

depth <- ggplot(geo_subset, aes(x = Location, y = depth)) +
       geom_boxplot(fill = 'grey23', alpha = 0.3) +
       xlab("Location") +
       ylab("Depth (mm)") +
       geom_text(data = final_depth, aes(x = Location, y = depth, label = Letters),
                 vjust = -6.5, hjust = 0.4) +
       theme_minimal() +
       theme(text = element_text(size = 12, family = 'sans', color = "black"))

```

### Investigating relationship between Depth and Length
Across the four locations Depth and Length show the same pattern. Florida females are deeper and longer than the Texas females. Here I am testing to see what the correlation is between depth and length.

```{r cor}
cor.test(geo_subset$length, geo_subset$depth) ##0.87

plot(geo_subset$length, geo_subset$depth, xlab = "Length (mm)", ylab = "Depth (mm)", pch = 16)
abline(lm(depth~length,data=geo_subset),lty=3, col="cyan4",lwd=3)
```
Due to the strong correlation between length and depth I will not be including both in the model as I am trying to avoid autocorrelation between my predictor variables. Depth will have a larger impact on the amount of iridescence present as the majority of the iridescence is present on the torso. Therefore, have a deeper torso means there is more area for iridescence to be present one. Going forward this is why a depth-adjusted measurment of iridescence is used. 

### Number of female bands across Location {.tabset}

#### Summary table
```{r table-numbands, echo=FALSE}
geo_subset %>% 
  group_by(Location) %>% 
  summarise(across(c("band_num"),  list(mean = mean, SD = sd))) %>%
  kable(caption = "Summarized Data", format = "html") %>% 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), full_width = F, position = "left")
```
#### Histogram
```{r histogram-numbands, message=F, echo = F, fig.cap = "Histogram of number of iridescent female bands across the four locations"}
num_band_hist <- ggplot(data = geo_subset, aes(x = band_num)) +
  geom_histogram(aes(fill = Location), 
                 alpha = 0.5, 
                 position = "identity") +
  scale_fill_manual(values = c("darkorange","purple","cyan4", "indianred")) +
  theme_minimal() +
  labs(x = "Number of Bands",
       y = "Frequency",
       title = "Number of Bands") 
num_band_hist
```

### {-}
#### Testing assumptions
```{r test-assumptions-numbands}
leveneTest(band_num~Location, geo_subset)

band_num_aov<-aov(geo_subset$band_num~geo_subset$Location)
band_numresid<-resid(band_num_aov)
shapiro.test(band_numresid)

par(mfrow=c(2,2))
plot(band_num_aov)

```

#### Running one-way ANOVA between Number of Bands and Location
```{r run-anova-numbands}
summary(band_num_aov)

#Post-hoc Analysis
tukey_bandnum <- TukeyHSD(x=band_num_aov, 'geo_subset$Location', conf.level = 0.95)
tukey_bandnum

```
Significant ANOVA results. From the post-hoc analysis we can see significant differences between the number of bands that females from the Florida population have versus females from the Texas populations.

```{r posthoc-letters-numbands, echo=F}
multcompLetters4(band_num_aov, TukeyHSD(band_num_aov))

par(mfrow=c(1,1))
boxplot(band_num~Location,data=geo_subset,ylab="Number of Bands",xlab="Location",main="")
```

#### Creating Figure
```{r fig-numbands, echo=F}
#Generate labels using function
labels_numbands <- generate_label_df(tukey_bandnum, "geo_subset$Location")

#Rename columns for merging
names(labels_numbands) <- c('Letters', 'Location')

#Obtain letter position for y axis using means
yvalue_numbands <- aggregate(band_num~Location, data=geo_subset, mean)

#Merge dataframes
final_numbands <- merge(labels_numbands, yvalue_numbands)

numbands <- ggplot(geo_subset, aes(x = Location, y = band_num)) +
       geom_boxplot(fill = 'grey23', alpha = 0.3) +
       xlab("Location") +
       ylab("Number of Iridescent Bands") +
       geom_text(data = final_numbands, aes(x = Location, y = band_num, label = Letters),
                 vjust = -8.5, hjust = 0.4) +
       theme_minimal() +
       theme(text = element_text(size = 12, family = 'sans', color = "black"))

```

```{r fig-combined-S2, echo=F, fig.height= 10}
top_rowFS2 <- plot_grid(length, SVL, depth, numbands,
                     ncol = 2,
                     nrow = 2,
                     labels = c('A', 'B', 'C', 'D'),
                     label_fontfamily = 'sans',
                     label_fontface = 'bold',
                     label_size = 18,
                     align = 'h',
                     rel_widths = c(1.10, 1.10, 1.10, 1.10))

plot_grid(top_rowFS2)
```

### Depth-adjusted Mean Band Iridescence across Location {.tabset}

#### Summary table
```{r table_bandiri, echo=FALSE}
geo_subset %>% 
  group_by(Location) %>% 
  summarise(across(c("DAI_hard"),  list(mean = mean, SD = sd))) %>%
  kable(caption = "Summarized Data", format = "html") %>% 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), full_width = F, position = "left")
```
#### Histogram
```{r histogram_bandiri, message=F, echo = F, fig.cap = "Histogram of Depth-adjusted mean band iridescence across the four locations"}
meaniri_hist <- ggplot(data = geo_subset, aes(x = DAI_hard)) +
  geom_histogram(aes(fill = Location), 
                 alpha = 0.5, 
                 position = "identity") +
  scale_fill_manual(values = c("darkorange","purple","cyan4", "indianred")) +
  theme_minimal() +
  labs(x = "Band Iridescence (mm^2)",
       y = "Frequency",
       title = "Depth-adjusted Mean Band Iridescence")
meaniri_hist
```

### {-}
#### Testing assumptions
```{r test-assumptions-meaniri}
leveneTest(DAI_hard~Location, geo_subset)

bandiri <- aov(DAI_hard~Location, geo_subset)
bandiriresid <- resid(bandiri)
shapiro.test(bandiriresid)

par(mfrow=c(2,2))
plot(bandiri)
```
All assumptions are not met, data fails normality as tested with shapiro.test. Cannot run a simple one-way ANOVA. Instead will use a GLMM with an underlying quasi-poisson distribution.

#### Running the model between Depth-adjusted Mean Band Iridescence and Location
```{r run-glmm-meaniri}
bandiriPS <- glmmPQL(DAI_hard~Location,
                     random=~1|Location,
                     family=quasipoisson,
                     data=geo_subset)
Anova(bandiriPS, type="III")
```
Non-significant results, mean band iridescence does not differ between populations.

```{r boxplot-meaniri, echo=F}
par(mfrow=c(1,1))
boxplot(DAI_hard~Location, data=geo_subset, ylab="Depth Adjusted Mean Band Iridescence", xlab="Location", main="")
```

```{r fig-meaniri, echo=F}
meaniri <- ggplot(geo_subset, aes(x = Location, y = DAI_hard)) +
       geom_boxplot(fill = 'grey23', alpha = 0.3) +
       xlab("Location") +
       ylab(bquote("Mean Band Iridescence (mm" ^ "  2"*")")) +
       theme_minimal() +
       theme(text = element_text(size = 12, family = 'sans', color = "black"))
```

### Depth-adjusted Overall Iridescence across Location {.tabset}

#### Summary table
```{r table_overalliri, echo=FALSE}
geo_subset %>% 
  group_by(Location) %>% 
  summarise(across(c("DAIT_easy"),  list(mean = mean, SD = sd))) %>%
  kable(caption = "Summarized Data", format = "html") %>% 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), full_width = F, position = "left")
```
#### Histogram
```{r histogram_overalliri, message=F, echo = F, fig.cap = "Histogram of Depth-adjusted overall iridescence across the four locations"}
overalliri_hist <- ggplot(data = geo_subset, aes(x = DAIT_easy)) +
  geom_histogram(aes(fill = Location), 
                 alpha = 0.5, 
                 position = "identity") +
  scale_fill_manual(values = c("darkorange","purple","cyan4", "indianred")) +
  theme_minimal() +
  labs(x = "Overall Iridescence (mm^2)",
       y = "Frequency",
       title = "Depth-adjusted Overall Iridescence")
overalliri_hist
```

### {-}
#### Testing assumptions
```{r test-assumptions-overalliri}
leveneTest(DAIT_easy~Location, geo_subset)

overalliri <- aov(geo_subset$DAIT_easy~geo_subset$Location)
overalliriresid <- resid(overalliri)
shapiro.test(overalliriresid)

par(mfrow=c(2,2))
plot(overalliri)
```
All assumptions are met, can proceed with a one-way ANOVA

#### Running the one-way ANOVA between Depth-adjusted Overall Iridescence and Location
```{r run-anova-overalliri}
summary(overalliri)

##Post-hoc analysis
tukey_overalliri <- TukeyHSD(x=overalliri, 'geo_subset$Location', conf.level = 0.95)
tukey_overalliri
```
Significant results from ANOVA. From the post-hoc analysis we can see signifcant differences between FL fort de soto population and the other three.

```{r posthoc-letters-overalliri, echo=F}
multcompLetters4(overalliri, TukeyHSD(overalliri))

par(mfrow=c(1,1))
boxplot(DAIT_easy~Location,
        data=geo_subset,
        ylab="Overall Iridescence", xlab="Location", main="")
```

#### Creating Figure
```{r fig-overalliri, echo=F}
#Generate labels using function
labels_overalliri <- generate_label_df(tukey_overalliri, "geo_subset$Location")

#Rename columns for merging
names(labels_overalliri) <- c('Letters', 'Location')

#Obtain letter position for y axis using means
yvalue_overalliri <- aggregate(DAIT_easy~Location, data=geo_subset, mean)

#Merge dataframes
final_overalliri <- merge(labels_overalliri, yvalue_overalliri)

overalliri_plot <- ggplot(geo_subset, aes(x = Location, y = DAIT_easy)) +
       geom_boxplot(fill = 'grey23', alpha = 0.3) +
       xlab("Location") +
       ylab(bquote("Overall Iridescence (mm" ^ "  2"*")")) +
       geom_text(data = final_overalliri, 
                 aes(x = Location, y = DAIT_easy, label = Letters),
                 vjust = -8.5, hjust = 0.4) +
       theme_minimal() +
       theme(text = element_text(size = 12, family = 'sans', color = "black"))

```

### Torso Iridescence across Location {.tabset}

#### Summary table
```{r table_torsoiri, echo=FALSE}
geo_subset %>% 
  group_by(Location) %>% 
  summarise(across(c("body_iri"),  list(mean = mean, SD = sd))) %>%
  kable(caption = "Summarized Data", format = "html") %>% 
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"), full_width = F, position = "left")
```
#### Histogram
```{r histogram_torsoiri, message=F, echo = F, fig.cap = "Histogram of Torso iridescence across the four locations"}
torsoiri_hist <- ggplot(data = geo_subset, aes(x = body_iri)) +
  geom_histogram(aes(fill = Location), 
                 alpha = 0.5, 
                 position = "identity") +
  scale_fill_manual(values = c("darkorange","purple","cyan4", "indianred")) +
  theme_minimal() +
  labs(x = "Torso Iridescence (mm^2)",
       y = "Frequency",
       title = "Torso Iridescence")
torsoiri_hist
```

### {-}
#### Testing assumptions
```{r test-assumptions-torsoiri}
leveneTest(body_iri~Location, geo_subset)

torsoiri_aov <- aov(body_iri~Location, geo_subset)
torsoiriresid <- resid(torsoiri_aov)
shapiro.test(torsoiriresid)

par(mfrow=c(2,2))
plot(torsoiri_aov)
```
All assumptions are not met, data fails normality as tested with shapiro.test. Cannot run a simple one-way ANOVA. Instead will use a GLMM with an underlying quasi-poisson distribution.

#### Running the model between Torso Iridescence and Location
```{r run-glmm-torsoiri}
torsoiriPS <- glmmPQL(body_iri~Location,
                    random=~1|Location,
                    family=quasipoisson,
                    data=geo_subset)
Anova(torsoiriPS, type="III")
```
Significant results, but no corresponding post-hoc test for this model so we can't see which locations are sig.different from each other

```{r boxplot-torsoiri, echo=F}
par(mfrow=c(1,1))
boxplot(body_iri~Location, data=geo_subset, ylab="Torso Iridescence", xlab="Location", main="")
```

### Creating the Figure
```{r fig-torsoiri, echo=F}
torsoiri <- ggplot(geo_subset, aes(x = Location, y = body_iri)) +
       geom_boxplot(fill = 'grey23', alpha = 0.3) +
       xlab("Location") +
       ylab(bquote("Torso Iridescence (mm" ^ "  2"*")")) +
       theme_minimal() +
       theme(text = element_text(size = 12, family = 'sans', color = "black"))

```

```{r fig-combined-F4, echo=F, fig.height=10}
top_rowF4 <- plot_grid(meaniri,
                     ncol = 2,
                     labels = c('A'),
                     label_fontfamily = 'sans',
                     label_fontface = 'bold',
                     label_size = 18,
                     rel_widths = c(1.10))
middle_rowF4 <- plot_grid(overalliri_plot,
                          ncol = 2,
                          labels = 'B',
                          label_fontfamily = 'sans',
                          label_fontface = 'bold',
                          label_size = 18,
                          rel_widths = 1.10)
bottom_rowF4 <- plot_grid(torsoiri,
                          ncol=2,
                          labels = 'C',
                          label_fontfamily = 'sans',
                          label_fontface = 'bold',
                          label_size = 18,
                          rel_widths = c(1.10))

plot_grid(top_rowF4, middle_rowF4, bottom_rowF4,
          ncol = 1,
          rel_heights = c(1.10, 1.10, 1.10))


```

### Investigating the Relationship between Band Area and Band Iridescence
This analysis was done for three of the four locations used above as we pulled band area measurements from (CITATION) and a Port Aransas, TX population was not used in that study.

```{r subset-data-ehs}
FLABehs <- subset(area_iri, Location=="FLAB")
FLFDehs <- subset(area_iri, Location=="FLFD")
TXSPehs <- subset(area_iri, Location=="TXSP")
```

#### Investigating correlations between area and iridescence
```{r cor-test}
##Looking at the correlation in the whole dataset
cor.test(area_iri$mean_sarah, area_iri$mean_hard) ##0.3685

##Looking at correlations within each Location
cor.test(FLABehs$mean_sarah, FLABehs$mean_hard) ##0.2455675
cor.test(FLFDehs$mean_sarah, FLFDehs$mean_hard) ##0.400215
cor.test(TXSPehs$mean_sarah, TXSPehs$mean_hard) ##0.4177789

```

Overall no strong correlations seen between band area and band iridescence, with the lowest correlation in the FL Anne's Beach population. This would probably be expected as those females possessed the most iridescence on the torso but not specifically located to the bands.

#### Creating Figure
```{r fig-F5, echo=F}
##Creating regression to plot best fit line
FLAB.reg<-lm(mean_hard~mean_sarah,data=FLABehs)
FLFD.reg<-lm(mean_hard~mean_sarah,data=FLFDehs)
TXSP.reg<-lm(mean_hard~mean_sarah,data=TXSPehs)

##Creating an empty plot
par(family="sans")
plot(mean_hard ~ mean_sarah,
     data=area_iri,
     type='n',
     xlab=expression(paste("Band Area (mm"^2*")")),
     ylab=""
)

##Adding y-axis label
title(ylab=expression(paste("Band Iridescence (mm"^2*")")), mgp=c(2.5,1,0))

##Adding points to empty plot
points(FLABehs$mean_sarah,FLABehs$mean_hard,pch=21,cex=1.5,col="black",bg="gray28")
points(FLFDehs$mean_sarah,FLFDehs$mean_hard, pch=22,cex=1.5,col="black",bg="gray59")
points(TXSPehs$mean_sarah,TXSPehs$mean_hard, pch=24,cex=1.5, col="black",bg="gray89")

##Adding best fir lines from regression models
abline(FLAB.reg,lty=3,col="gray28",lwd=3)
abline(FLFD.reg,lty=2,col="gray59",lwd=3)
abline(TXSP.reg,lty=1,col="gray89",lwd=3)

##Adding the Legend
legend("topleft", c("Florida Anne's Beach","Florida Fort De Soto",
                    "Texas South Padre"), 
       lty=c(3,2,1), 
       col=c("gray28","gray59","gray89"), 
       bty='o',
       lwd=3)

legend('topright', c("","",""), 
       pch=c(21,22,24),
       pt.bg = c("gray28","gray59","gray89"),
       pt.lwd = 1,
       col=c("black"), bty='n',
       text.width = 1.44,
       cex=1.0
       )
```